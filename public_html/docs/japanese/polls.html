<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="ja">
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
  <meta http-equiv="Content-Style-Type" content="text/css" />
  <title>アンケートプラグイン | Geeklogドキュメント</title>
  <link rel="stylesheet" type="text/css" href="../docstyle.css" title="Dev Stylesheet" />
  <link rel="stylesheet" type="text/css" href="docstyle.css" title="Dev Stylesheet" />
</head>

<body>
<p><a href="https://www.geeklog.jp" style="background:transparent"><img src="../images/logo.gif" alt="Geeklog Documentation" width="243" height="90" /></a></p>
<div class="menu"><a href="index.html">Geeklogドキュメント</a> - アンケート(Polls)プラグイン</div>

<h1>アンケート(Polls)プラグイン</h1>

<p>アンケート機能はかつてGeeklogのコアコードの一部でしたが、Geeklog 1.4.0よりプラグインとして分離されました。</p>

<h2><a name="config.php">設定</a></h2>

<p>アンケートプラグインの設定は、「管理者用メニュー - コンフィギュレーション - アンケート」から変更できます。</p>

<h3><a name="general">アンケートのメイン設定</a></h3>

<table>
<tr><th style="width:25%">項目(変数)</th>
    <th style="width:25%">デフォルト</th>
    <th style="width:50%">説明</th>
</tr>
<tr>
  <td><a name="desc_pollsloginrequired">ログインを要求する(pollsloginrequired)</a></td>
  <td>いいえ(0)</td>
  <td>はい(1)にすると、登録ユーザーしか最近のアンケートにアクセスできなくなります。<br />
    この設定値よりも、「管理者用メニュー - コンフィギュレーション - Geeklog - ユーザーと投稿」の「<a href="config.html#desc_loginrequired">すべてにログインを要求する(loginrequired)</a>」の設定の方が優先されます。「すべてにログインを要求する」をはい(1)にすると、アンケートプラグインでログインを要求していなくても、ゲストユーザーはアンケートにアクセスできなくなります。</td>
</tr>
<tr>
  <td><a name="desc_hidepollsmenu">メニューに表示しない(hidepollsmenu)</a></td>
  <td>いいえ(0)</td>
  <td>はい(1)にすると、サイトのメニューに「アンケート」メニューを表示しません。</td>
</tr>
<tr>
  <td><a name="desc_maxquestions">アンケート毎の質問の最大数(maxquestions)</a></td>
  <td>10</td>
  <td>アンケート毎の質問の最大数を指定します。</td>
</tr>
<tr>
  <td><a name="desc_maxanswers">質問毎の選択肢の最大数(maxanswers)</a></td>
  <td>10</td>
  <td>質問毎の選択肢の最大数を指定します。</td>
</tr>
<tr>
  <td><a name="desc_answerorder">アンケート結果の表示順(answerorder)</a></td>
  <td>登録順(submitorder)</td>
  <td>アンケート結果を「得票順(voteorder)」に並び替えるか、アンケートの「登録順(submitorder)」で並び替えるかを指定します。</td>
</tr>
<tr>
  <td><a name="desc_pollcookietime">投票者のクッキーの有効期間(pollcookietime)</a></td>
  <td>86400(秒)</td>
  <td>投票者のクッキーの有効期間を秒数で指定します。いったん投票すると、この期間は同じ質問に投票できません。デフォルトは86,400秒(＝24時間)です。</td>
</tr>
<tr>
  <td><a name="desc_polladdresstime">投票者のIPアドレスの有効期間(polladdresstime)</a></td>
  <td>604800</td>
  <td>投票者のIPアドレスの有効期間を秒数で指定します。いったん投票すると、この期間は同じIPから投票できません。デフォルトは604,800秒(＝7日間)です。</td>
</tr>
<tr>
  <td><a name="desc_delete_polls">所有者の削除と共に削除する(delete_polls)</a></td>
  <td>いいえ(0)</td>
  <td>はい(1)にすると、アンケート所有者のアカウントが削除されたときに、所有していたすべてのアンケートが全コメントと共に削除され、いいえ(0)にすると、Rootグループに属するユーザー(たとえば、サイトの管理者)に引き継がれます。</td>
</tr>
<tr>
  <td><a name="desc_aftersave">アンケート保存後の画面遷移(aftersave)</a></td>
  <td>アンケート管理を表示する(list)</td>
  <td>アンケートを保存した後にどのページへ移動するかをを指定します。
    <ul>
    <li>作成したアンケートを表示する(item): 作成したアンケートを表示します。</li>
    <li>アンケート管理一覧を表示する(list): 管理者用のアンケートのリストを表示します(デフォルト)。</li>
    <li>アンケート一覧を表示する(plugin): 公開されているアンケート一覧を表示します。</li>
    <li>Homeを表示する(home): サイトのHomeページ(トップページ)を表示します。</li>
    <li>管理画面TOPを表示する(admin): 管理画面を表示します。</li>
    </ul></td>
</tr>
<tr>
  <td><a name="desc_meta_tags">メタタグを有効にする(meta_tags)</a></td>
  <td>いいえ(false)</td>
  <td>アンケートを表示するときに、メタタグを出力するかどうかを指定します。</td>
</tr>
<tr>
  <td valign="top"><a name="desc_likes_polls">アンケートのlikesコントロール(likes_polls)</a></td>
  <td valign="top">1</td>
  <td valign="top">0にするとLikesコントロールを無効にし、1にするとLikesとDislikesを有効に、2にするとLikesのみ有効にします。アンケートのLikesコントロールを有効にするには、Geeklogのコンフィギュレーション(likes_enabled)でLikesを有効にしなければなりません。</td>
</tr>
</table>

<h3><a name="whatsnew">新着ブロック</a></h3>

<table>
<tr><th style="width:25%">項目(変数)</th>
    <th style="width:25%">デフォルト</th>
    <th style="width:50%">説明</th>
</tr>
<tr>
  <td valign="top"><a name="desc_newpollsinterval">アンケートの"新着"期間(newpollsinterval)</a></td>
  <td valign="top">1209600秒 (= 2週間)</td>
  <td valign="top">アンケートが新着ブロックに表示される期間を秒数で指定します。</td></tr>
<tr>
  <td valign="top"><a name="desc_hidenewpolls">新着アンケート(hidenewpolls)</a></td>
  <td valign="top">表示しない</td>
  <td valign="top">新着ブロックに、'表示しない'、'作成日付によって表示する'、'編集日付によって表示する'を選択します。</td></tr>
<tr>
  <td valign="top"><a name="desc_title_trim_length">タイトル最大長(title_trim_length)</a></td>
  <td valign="top">20</td>
  <td valign="top">新着ブロックに表示するタイトルのトリミングの文字数を指定します。</td></tr>
</table>

<h3><a name="search">パーミッションのデフォルト</a></h3>

<table>
<tr><th style="width:25%">項目(変数)</th>
    <th style="width:25%">デフォルト</th>
    <th style="width:50%">説明</th>
</tr>
<tr>
  <td valign="top"><a name="desc_default_permissions_0">パーミッションのデフォルト[0](default_permissions[0])</a></td>
  <td valign="top"><em>表示・編集</em></td>
  <td valign="top">アンケートに関する所有者のパーミッションのデフォルトを指定します。</td></tr>
<tr>
  <td valign="top"><a name="desc_default_permissions_1">パーミッションのデフォルト[1](default_permissions[1])</a></td>
  <td valign="top"><em>表示</em></td>
  <td valign="top">アンケートに関するグループのパーミッションのデフォルトを指定します。</td></tr>
<tr>
  <td valign="top"><a name="desc_default_permissions_2">パーミッションのデフォルト[2](default_permissions[2])</a></td>
  <td valign="top"><em>表示</em></td>
  <td valign="top">アンケートに関するメンバーのパーミッションのデフォルトを指定します。</td></tr>
<tr>
  <td valign="top"><a name="desc_default_permissions_3">パーミッションのデフォルト[3](default_permissions[3])</a></td>
  <td valign="top"><em>表示</em></td>
  <td valign="top">アンケートに関するゲストユーザーのパーミッションのデフォルトを指定します。</td></tr>
</table>

<h3><a name="search">自動タグのパーミッション</a></h3>

<table>
<tr><th style="width:25%">項目(変数)</th>
    <th style="width:25%">デフォルト</th>
    <th style="width:50%">説明</th>
</tr>
<tr>
  <td valign="top"><a name="desc_autotag_permissions_poll_0">自動タグ[poll: ]のパーミッション[0](autotag_permissions_poll[0])</a></td>
  <td valign="top"><em>利用する</em></td>
  <td valign="top">自動タグの利用に関する所有者(デフォルトはRootユーザー)のパーミッションを指定します。</td></tr>
<tr>
  <td valign="top"><a name="desc_autotag_permissions_poll_1">自動タグ[poll: ]のパーミッション[1](autotag_permissions_poll[1])</a></td>
  <td valign="top"><em>利用する</em></td>
  <td valign="top">自動タグの利用に関するPolls Adminグループのパーミッションを指定します。</td></tr>
<tr>
  <td valign="top"><a name="desc_autotag_permissions_poll_2">自動タグ[poll: ]のパーミッション[2](autotag_permissions_poll[2])</a></td>
  <td valign="top"><em>利用する</em></td>
  <td valign="top">自動タグの利用に関するメンバーのパーミッションを指定します。</td></tr>
<tr>
  <td valign="top"><a name="desc_autotag_permissions_poll_3">自動タグ[poll: ]のパーミッション[3](autotag_permissions_poll[3])</a></td>
  <td valign="top"><em>利用する</em></td>
  <td valign="top">自動タグの利用に関するゲストユーザーのパーミッションを指定します。</td></tr>

<tr>
  <td valign="top"><a name="desc_autotag_permissions_poll_vote_0">自動タグ[poll_vote: ]のパーミッション[0](autotag_permissions_poll_vote[0])</a></td>
  <td valign="top"><em>利用する</em></td>
  <td valign="top">自動タグの利用に関する所有者(デフォルトはRootユーザー)のパーミッションを指定します。</td></tr>
<tr>
  <td valign="top"><a name="desc_autotag_permissions_poll_vote_1">自動タグ[poll_vote: ]のパーミッション[1](autotag_permissions_poll_vote[1])</a></td>
  <td valign="top"><em>利用する</em></td>
  <td valign="top">自動タグの利用に関するPolls Adminグループのパーミッションを指定します。</td></tr>
<tr>
  <td valign="top"><a name="desc_autotag_permissions_poll_vote_2">自動タグ[poll_vote: ]のパーミッション[2](autotag_permissions_poll_vote[2])</a></td>
  <td valign="top"><em>アクセス不可</em></td>
  <td valign="top">自動タグの利用に関するメンバーのパーミッションを指定します。</td></tr>
<tr>
  <td valign="top"><a name="desc_autotag_permissions_poll_vote_3">自動タグ[poll_vote: ]のパーミッション[3](autotag_permissions_poll_vote[3])</a></td>
  <td valign="top"><em>アクセス不可</em></td>
  <td valign="top">自動タグの利用に関するゲストユーザーのパーミッションを指定します。</td></tr>

<tr>
  <td valign="top"><a name="desc_autotag_permissions_poll_result_0">自動タグ[poll_result: ]のパーミッション[0](autotag_permissions_poll_result[0])</a></td>
  <td valign="top"><em>利用する</em></td>
  <td valign="top">自動タグの利用に関する所有者(デフォルトはRootユーザー)のパーミッションを指定します。</td></tr>
<tr>
  <td valign="top"><a name="desc_autotag_permissions_poll_result_1">自動タグ[poll_result: ]のパーミッション[1](autotag_permissions_poll_result[1])</a></td>
  <td valign="top"><em>利用する</em></td>
  <td valign="top">自動タグの利用に関するPolls Adminグループのパーミッションを指定します。</td></tr>
<tr>
  <td valign="top"><a name="desc_autotag_permissions_poll_result_2">自動タグ[poll_result: ]のパーミッション[2](autotag_permissions_poll_result[2])</a></td>
  <td valign="top"><em>アクセス不可</em></td>
  <td valign="top">自動タグの利用に関するメンバーのパーミッションを指定します。</td></tr>
<tr>
  <td valign="top"><a name="desc_autotag_permissions_poll_result_3">自動タグ[poll_result: ]のパーミッション[3](autotag_permissions_poll_result[3])</a></td>
  <td valign="top"><em>アクセス不可</em></td>
  <td valign="top">自動タグの利用に関するゲストユーザーのパーミッションを指定します。</td></tr>
</table>

<h3><a name="pollblock">アンケートブロック</a></h3>

<table>
<tr><th style="width:25%">項目(変数)</th>
    <th style="width:25%">デフォルト</th>
    <th style="width:50%">説明</th>
</tr>
<tr>
  <td valign="top"><a name="desc_block_enable">有効(block_enable)</a></td>
  <td valign="top">true</td>
  <td valign="top">ブロックを有効化します。</td></tr>
<tr>
  <td valign="top"><a name="desc_block_isleft">左ブロックで表示する(block_isleft)</a></td>
  <td valign="top">1</td>
  <td valign="top">左ブロックで表示(1) あるいは右 (0)に表示します。</td></tr>
<tr>
  <td valign="top"><a name="desc_block_order">ブロックの順番(block_order)</a></td>
  <td valign="top">50</td>
  <td valign="top">ブロックカラムの並べ替え番号を指定します。</td></tr>
<tr>
  <td valign="top"><a name="desc_block_topic_option">話題オプション(block_topic_option)</a></td>
  <td valign="top">'all'</td>
  <td valign="top">'すべて'なら、すべてのページで表示。'ホームページのみ'ならホームページのみで表示。'話題を選択する'なら選択された話題でのみ表示されます。</td></tr>
<tr>
  <td valign="top"><a name="desc_block_topic">話題(block_topic)</a></td>
  <td valign="top"></td>
  <td valign="top">話題オプションが '話題を選択する'のときだけ表示されます。</td></tr>
<tr>
  <td valign="top"><a name="desc_block_group_id">グループ(block_group_id)</a></td>
  <td valign="top">Calendar Admin</td>
  <td valign="top">パーミッションで使われるグループ</td></tr>
<tr>
  <td valign="top"><a name="desc_block_permissions_0">アンケートブロックのパーミッション[0](block_permissions[0])</a></td>
  <td valign="top"><em>表示</em></td>
  <td valign="top">ダイナミックブロックの表示に関するブロック管理者(デフォルトはRootユーザー)のパーミッションを設定します。</td></tr>
<tr>
  <td valign="top"><a name="desc_block_permissions_1">アンケートブロックのパーミッション[1](block_permissions[1])</a></td>
  <td valign="top"><em>表示</em></td>
  <td valign="top">ダイナミックブロックの表示に関する、アサインされた管理者グループ(コンフィグオプションblock_group_idを参照)のパーミッションを設定します。</td></tr>
<tr>
  <td valign="top"><a name="desc_block_permissions_2">アンケートブロックのパーミッション[2](block_permissions[2])</a></td>
  <td valign="top"><em>表示</em></td>
  <td valign="top">ダイナミックブロックの表示に関するメンバーのパーミッションを設定します。</td></tr>
<tr>
  <td valign="top"><a name="desc_block_permissions_3">アンケートブロックのパーミッション[3](block_permissions[3])</a></td>
  <td valign="top"><em>表示</em></td>
  <td valign="top">ダイナミックブロックの表示に関するゲストユーザーのパーミッションを設定します。</td></tr>   
</table>

<h2>アンケートの仕組み</h2>

<p><small>(<a href="https://www.geeklog.net/faqman/">Geeklog
FAQ</a>より転載)</small></p>

<p>アンケートの恣意的な操作を防ぐ(少なくとも困難にする)ために、Geeklogは投票時に次の2つのことを行います。</p>

<ol>
  <li>クッキーを保存します。</li>
  <li>投票者のIPアドレスを記録します。</li>
</ol>

<p>クッキーとIPアドレスは一定期間有効で(下記参照)、その期間中は同じアンケートに答えることはできません。</p>

<p>クッキーとIPアドレスの有効期間は「管理者用メニュー - コンフィギュレーション - アンケート」で変更できます(上記参照)。</p>

<pre>$_PO_CONF['<a href="#desc_pollcookietime">pollcookietime</a>']    = 86400;
$_PO_CONF['<a href="#desc_polladdresstime">polladdresstime</a>']   = 604800;</pre>

<p>単位は共に秒で、上記の例ではクッキーの有効期間は24時間であり、IPアドレスは1週間記録されることになります。</p>

<p>複数の人間が同一コンピュータや同一IPアドレスを使用する状況では、いずれか(または両方の)数値を <code>1</code> に設定するとよいでしょう。</p>

<p><strong>どんな</strong>アンケートでも操作される可能性があることを忘れないでください。したがって結果をあまり重大に受け止めない方がよいでしょう。</p>


<h2><a name="autotags">自動タグ</a></h2>

<p>アンケートプラグインは、<code>[poll:]</code>、<code>[poll_result:]</code>、<code>[poll_vote:]</code>という3種類の<a href="https://www.geeklog.net/article.php/autolinks" title="geeklog.net: About Autolinks and Autotags">自動タグ</a>を提供します。</p>

<ul>
<li><code>[poll:]</code> 自動タグはアンケートへのリンクに変換されます。コロンの後にアンケートIDを記述してください。既定では、アンケートのタイトルがリンクテキストとして使用されます。別の方法としては、アンケートIDの後に半角スペースに続けて独自のリンクテキストを指定することもできます(閉じカッコの前でなければなりません)。</li>
<li><code>[poll_result:]</code> 自動タグを使用すると、アンケート結果を記事(や、自動タグが使用できるところならどこにでも)に埋め込むことができます。</li>
<li><code>[poll_vote:]</code> 自動タグを使用すると、アンケートを記事(や、自動タグが使用できるところならどこにでも)に埋め込むことができます。ユーザーがアンケートのページへ移動する手間を省くわけです。</li>
</ul>

<div class="footer">
    <a href="https://wiki.geeklog.net/">Geeklogドキュメント作成プロジェクト</a>、<a href="https://wiki.geeklog.jp/">Geeklogドキュメント日本語版作成プロジェクト</a><br />
    本ページのすべての商標と著作権はそれぞれの所有者に帰属します。Geeklogはコピーレフトです。
</div>

</body>
</html>
