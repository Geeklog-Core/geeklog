<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html lang="ja">
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <meta http-equiv="Content-Style-Type" content="text/css">
  <title>プラグイン開発 | Geeklogドキュメント</title>
  <link rel="stylesheet" type="text/css" href="docstyle.css" title="Dev Stylesheet">
</head>

<body>
<p><a href="http://www.geeklog.jp" style="background:transparent"><img src="../images/newlogo.gif" alt="Geeklog Documentation" width="243" height="90"></a></p>
<div class="menu"><a href="index.html">Geeklogドキュメント</a> - プラグイン開発</div>

<h1>プラグイン開発</h1>

<p><strong>注意:</strong> 残念ながら、このドキュメントは少し古くなっています（訳注：<strong>かなり古くなっている</strong>箇所もあります。本家の<a href="http://wiki.geeklog.net/wiki/index.php/Plugin_Developers_Handbook">Wiki</a>や<a href="http://wiki.geeklog.jp/index.php/PluginDev">Geeklog.jpのWiki</a>も参照してください。）。ここに記述されているAPI機能は今でも正常に機能しますが、新しい関数の中には取り上げられていないものもあります。はっきりしない場合は、プラグインインターフェースを実装している <tt>system/lib-plugins.php</tt> を見てください。</p>

<p>以下のAPIの記述が簡潔すぎると思われるなら、より広範囲をカバーする<a href="http://wiki.geeklog.net/index.php/Plugin_Developers_Handbook">プラグイン開発者ガイド</a>を見る必要があるでしょう。</p>

<ul>
  <li><a href="#overview">概要</a></li>
  <li><a href="#Functions_for_writing">GeeklogプラグインAPI関数</a>
    <ul>
      <li><a href="#mod_functions">モデレーション用関数</a></li>
      <li><a href="#admin_user_functions">管理者及びユーザメニュー用関数</a></li>
      <li><a href="#Search_Functions">検索用関数</a></li>
      <li><a href="#Comment_Functions">コメント用関数</a></li>
      <li><a href="#Stats_Function">統計用関数</a></li>
      <li><a href="#Uninstall_Function">アンインストール用関数</a></li>
      <li><a href="#User_Functions">ユーザ用関数</a></li>
      <li><a href="#Profile_Functions">プロフィール用関数</a></li>
      <li><a href="#Misc_Functions">その他の関数</a></li>
      <li><a href="#Feed_Functions">フィード用関数</a></li>
    </ul></li>
  <li><a href="#Implementing_your_Admin_Interface">独自の管理者インターフェースの実装</a></li>
  <li><a href="#Preparing_your_Geeklog_Plugin">プラグイン配布の準備</a></li>
  <li><a href="#How_Geeklog_Installs_Plugins">プラグインのインストール方法</a></li>
  <li><a href="#Deliver_Your_Plugin">プラグインの配布</a></li>
</ul>

<h2><a name="overview">概要</a></h2>

<p>Geeklogは日々人気が高まり、独自の要求を満たすためGeeklogの機能拡張を行うためにユーザが行うハックに開発者たちは驚いています。それと同時に、開発者チームはGeeklogを改良するために絶えず新機能を追加しています。私たちはGeeklogのコアコードとプラグインの2系統をサポートする必要があることを理解しています。プラグインによってGeeklogの機能を拡張するのに必要なインフラを整備することにより、私たちはGeeklogのコアコードとプラグインを明確に分離することができます。そうすることで、私たちはコアコードの開発に、他のユーザは自分の要求にあったプラグインの開発に専念することができます。そういうわけで、GeeklogにはプラグインAPIが備わっています。</p>

<p>最上位のレベルで考えると、GeeklogのプラグインAPIはGeeklogのコアコードの要所要所で呼び出される汎用のコードであり、プラグインの関数を呼び出すことが可能になります。プラグインは以下の機能を与えられています。</p>

<ul>
  <li>プラグインはユーザの投稿を受け付けることができる。管理者はコントロールパネルでプラグイン宛に投稿されたデータのモデレーションを行える。</li>
  <li>プラグインはGeeklogのページごとにプラグインを管理者ブロックとユーザブロックに表示することができる。</li>
  <li>プラグインはGeeklogの検索ページ経由でプラグインを検索対象とすることができる。</li>
  <li>プラグインはプラグインの統計情報をサイトの統計情報に表示することができる。</li>
  <li>プラグインはGeeklogのコメントエンジンを使用できる。</li>
  <li>プラグインは、Geeklogのコアコード(<tt>lib-common.php</tt>)を使用できる。</li>
  <li>プラグインには完全な柔軟性が与えられる。Geeklogはプラグインにあれこれ要求したりしない。</li>
</ul>

<h2><a name="Functions_for_writing">プラグインを書くための関数</a></h2>

<p>以下の関数は、必須パラメータに加えて追加パラメータを含めて独自のプラグインを書くために必要なものです。プラグインの処理を理解する必要がある場合に備えて、このページの最後付近にAPIの記述があります。

<p>
<strong>&lt;プラグイン名&gt;</strong> の表記に注意：以下の関数で &lt;プラグイン名&gt; という記述がありますが、これはプラグインのアーカイブファイル名に由来するものです（訳注：正確には、プラグイン名）。プラグインのアーカイブファイル名は以下の記法に<strong>従わなければなりません</strong>。</p>

<p style="margin-left:4em;">
  &lt;プラグイン名&gt;_&lt;プラグインのバージョン&gt;_&lt;Geeklogのバージョン&gt;.tar.gz
</p>

<p>例：<tt>photos_1.0_1.3.tar.gz</tt></p>

<h2><a name="mod_functions">モデレーション用関数</a></h2>

<p>現在のGeeklogのコアコードでは、投稿物を処理するためのデータベースのテーブル名には従わなければならない規約があります。記事やリンクなどのモデレーションされるアイテムは2つのテーブルを使用します。最初のテーブルは主要なもので、公開されるすべてのアイテムが保存されます。2番目のテーブルは管理者が承認するまで投稿物が保存されるテーブルです。アイテムが承認されると、2番目のテーブルから1番目のテーブルに移されます。たとえば、ユーザの書評投稿を受け付ける書評プラグインを制作しているなら、1番目のテーブルの名前を <tt>bookreviews</tt> とし（また、プラグイン名も <tt>bookreviews</tt>と<strong>しなければなりません</strong>）、2番目のテーブル名を <tt>bookreviewssubmission</tt> としなければなりません。このような命名を強制するのは、Geeklogのコアコードで<br><code>2番目のテーブル名 = &lt;1番目のテーブル名&gt;submission</code><br>とコーディングされているからです。ですから、プラグイン名を <tt>bookreviews</tt> とするなら、1番目のテーブル名は <tt>bookreviews</tt> 、2番目のテーブル名は <tt>bookreviewssubmission</tt> としなければなりません。</p>

<p>Geeklogの記事やリンクプラグインのように、プラグインにモデレートさせたいなら、以下の関数を実装しなければなりません。</p>

<table>
<caption style="caption-side:bottom">表1. モデレーション用関数<br></caption>
<tr>
  <th valign="top">関数名</th>
  <th valign="top">関数の説明</th></tr>
<tr>
  <td valign="top" class="codeheader">plugin_submit_&lt;プラグイン名&gt;</td>
  <td valign="top" class="code">プラグインの投稿フォームを表示する。</td>
  </tr>
<tr>
  <td valign="top" class="codeheader">plugin_itemlist_&lt;プラグイン名&gt;</td>
  <td valign="top" class="code">プラグインへ投稿されたアイテムでモデレーションを必要とするものを <tt>moderation.php</tt> で表示する。</td>
  </tr>
<tr>
  <td valign="top" class="codeheader">plugin_savesubmission_&lt;プラグイン名&gt;</td>
  <td valign="top" class="code">ユーザが投稿したアイテムを &lt;プラグイン名&gt;submission テーブルに保存する。</td>
  </tr>
<tr>
  <td valign="top" class="codeheader">plugin_moderationdelete_&lt;プラグイン名&gt;</td>
  <td valign="top" class="code">&lt;プラグイン名&gt;submission テーブルで該当するIDのデータを削除する。</td>
  </tr>
<tr>
  <td valign="top" class="codeheader">plugin_moderationapprove_&lt;プラグイン名&gt;</td>
  <td valign="top" class="code">&lt;プラグイン名&gt;submission テーブルで該当するIDのデータを主テーブル（&lt;プラグイン名&gt;）へ移す。</td>
  </tr>
<tr>
  <td valign="top" class="codeheader">plugin_moderationvalues_&lt;プラグイン名&gt;</td>
  <td valign="top" class="code">主テーブル（&lt;プラグイン名&gt;）のプライマリキーのあるフィールド名、テーブル名、モデレーション用のページに表示したいフィールド名のリストを返す。</td>
  </tr>
</table>

<h2><a name="admin_user_functions">管理者及びユーザメニュー用関数</a></h2>

<p>Geeklogのページごとに管理者機能ブロックとユーザ機能ブロックにプラグインを表示したいなら、以下の関数を実装しなければなりません。</p>

      <table>
        <caption style="caption-side:bottom">表2. 管理者及びユーザメニュー用関数</caption>
          <tr>
            <th valign="top">関数名</th>
            <th valign="top">関数の説明</th>
          </tr>
          <tr>
            <td valign="top" class="codeheader">plugin_adminoptions_&lt;プラグイン名&gt;</td>
            <td valign="top" class="code">管理者機能ブロックにプラグインのオプションを表示する。</td>
          </tr>
          <tr>
            <td valign="top" class="codeheader">plugin_getuseroption_&lt;プラグイン名&gt;</td>
            <td valign="top" class="code">ユーザ機能ブロックにプラグインのオプションを表示する。</td>
          </tr>
          <tr>
            <td valign="top" class="codeheader">plugin_adminedit_&lt;プラグイン名&gt;</td>
            <td valign="top" class="code"><tt>admin/plugins/&lt;プラグイン名&gt;.php</tt> のトップに「新規作成」と「管理者機能HOME」へのリンクを表示する。この関数は整合性を取るためにのみ存在する。</td>
          </tr>
          <tr>
            <td valign="top" class="codeheader">plugin_submissioncount_&lt;プラグイン名&gt;</td>
            <td valign="top" class="code">プラグインに投稿されたアイテムで承認待ちの投稿数を表示する。ふつう、これは <code>"SELECT (*) FROM `&lt;プラグイン名&gt;submission`"</code> と等価の動作である。</td>
          </tr>
          <tr>
            <td valign="top" class="codeheader">plugin_cclabel_&lt;プラグイン名&gt;</td>
            <td valign="top" class="code">プラグインのアイコンとリンクテキストの配列を返す。<tt>moderation.php</tt> のコントロールパネルでプラグインのデータを表示するために使用される。</td>
          </tr>
      </table>

<h2><a name="Search_Functions">検索用関数</a></h2>

<p>プラグインのデータを検索可能にしたいなら、以下の関数を実装しなければなりません。</p>

      <table>
        <caption style="caption-side:bottom">表3. 検索用関数</caption>
          <tr>
            <th valign="top">関数名</th>
            <th valign="top">関数の説明</th>
          </tr>
          <tr>
            <td valign="top" class="codeheader">plugin_getsearchtypes_&lt;プラグイン名&gt;</td>
            <td valign="top" class="code"><tt>search.php</tt> の検索タイプにプラグインに対応する新しいタイプを追加しなければならないだろう。この関数では必要とされる <tt>&lt;options&gt;</tt> タグを表示する。<tt>value属性</tt> は &lt;プラグイン名&gt; でなければならない。</td>
          </tr>
          <tr>
            <td valign="top" class="codeheader">plugin_dopluginsearch_&lt;プラグイン名&gt;</td>
            <td valign="top" class="code">検索条件を受け取り、プラグインの検索結果を返す。返り値はテーブルの列を文字列の配列にしたもので、1列が検索によって返される1レコードに対応するものとなっている。</td>
          </tr>
      </table>

<h2><a name="Comment_Functions">コメント用関数</a></h2>

<p>プラグインがコメントをサポートし、Geeklogのコメントエンジンを使用したいなら、以下の関数をプラグインの <tt>functions.inc</tt> ファイル内に実装する必要があります。</p>

<table>
<caption style="caption-side:bottom">表4. コメント用関数</caption>
  <tr>
    <th valign="top">関数名</th>
    <th valign="top">関数の説明</th>
  </tr>
  <tr>
    <td valign="top" class="codeheader">plugin_commentsupport_&lt;プラグイン名&gt;</td>
    <td valign="top" class="code">
    この関数は引数を取らない。プラグインがコメントをサポートする場合には <tt>true</tt> を返すだけである。この関数はGeeklogのコード内（たとえば、<tt>article.php</tt>）で呼び出され、コードがコメントの扱いをプラグインに委ねるかどうかが判断される。</td>
  </tr>
  <tr>
    <td valign="top" class="codeheader">plugin_handlecomment_&lt;プラグイン名&gt;</td>
    <td valign="top" class="code">
    この関数はコメントID（コメント用テーブルでプライマリキーのあるフィールド）とコメントに対する操作のタイプ（'save'か'delete'のどちらか）を受け取る。プラグインのレコードのコメントの総数が更新される。それから、サイトのメインページにではなくプラグインのページにユーザをリダイレクトまたはリフレッシュする。</td>
  </tr>
  <tr>
    <td valign="top" class="codeheader">plugin_commentform_&lt;プラグイン名&gt;</td>
    <td valign="top" class="code">
    この関数は多数のパラメータを受け取り、Geeklogの <tt>article.php</tt> と <tt>comment.php</tt> から呼ばれる。パラメータは、コメントID（プライマリキー）、コメントモード（nested, flat, threaded, none）、順序（昇順・降順）、返答（コメントバーの「コメントを追加」ボタンが使用されたかどうか）である。<br>
    コメントIDのみ必須である。</td>
  </tr>
  <tr>
    <td valign="top" class="codeheader">plugin_commentparent_&lt;プラグイン名&gt;</td>
    <td valign="top" class="code">
    プラグインのコメントフォーム関数から親コメントを表示するために呼び出すことが可能なオプションの関数。このやり方で、Geeklogは記事と共にコメントバーと関連するコメントを表示している。</td>
  </tr>
</table>


<h2><a name="Stats_Function">統計用関数</a></h2>

<p>プラグインの統計情報をサイトの統計情報に表示したいなら、以下の関数を実装しなければなりません。</p>

      <table>
        <caption style="caption-side:bottom">表5. 統計用関数</caption>
          <tr>
            <th valign="top">関数名</th>
            <th valign="top">関数の説明</th>
          </tr>
          <tr>
            <td valign="top" class="codeheader">plugin_showstats_&lt;プラグイン名&gt;</td>
            <td valign="top" class="code">この関数はshowsitestatsフラグを取る。1 に設定すると、この関数はプラグインの全般的な統計情報をサイトの統計情報ページに表示する。2 に設定すると、プラグインの詳細な統計情報を表示する（記事の中で閲覧回数の上位10位、コメント数の多い上位10位などに似た情報）。</td>
          </tr>
      </table>

<h2><a name="Uninstall_Function">アンインストール用関数</a></h2>

<p>自動的にアンインストールする機能をプラグインに与えるなら、以下の関数を実装しなければなりません。</p>

      <table>
        <caption style="caption-side:bottom">表6. アンインストール用関数</caption>
          <tr>
            <th valign="top">関数名</th>
            <th valign="top">関数の説明</th>
          </tr>
          <tr>
            <td valign="top" class="codeheader">plugin_uninstall_&lt;プラグイン名&gt;</td>
            <td valign="top" class="code">この関数は引数を取らない。アンインストールを試み、データベースから該当するテーブルと情報を削除する。<br>
アンインストールが成功したら <code>true</code> 、失敗したら <code>false</code> を返さなければならない。</td>
          </tr>
      </table>

<h2><a name="User_Functions">ユーザ用関数</a></h2>

<p>プラグインの中には、ユーザアカウントの作成・削除を監視しなければならないものがあります。</p>

  <table>
    <caption style="caption-side:bottom">表7. ユーザ用関数</caption>
      <tr>
        <th valign="top">関数名</th>
        <th valign="top">関数の説明</th>
      </tr>
      <tr>
        <td valign="top" class="codeheader">plugin_user_create_&lt;プラグイン名&gt;</td>
        <td valign="top" class="code">ユーザアカウントが新規作成されたとき、この関数が呼び出される。渡される唯一のパラメータはユーザIDである。<br>
この関数は返り値を持たない。</td>
      </tr>
      <tr>
        <td valign="top" class="codeheader">plugin_user_delete_&lt;プラグイン名&gt;</td>
        <td valign="top" class="code">ユーザアカウントが削除されたとき、この関数が呼び出される。渡される唯一のパラメータはユーザIDである。<br>
この関数は返り値を持たない。</td>
      </tr>
  </table>

<h2><a name="Profile_Functions">プロフィール用関数</a></h2>

<p>プラグインは、ユーザのプロフィールにブロックや個々の項目を追加できます。</p>

  <table>
    <caption style="caption-side:bottom">表8. プロフィール用関数</caption>
      <tr>
        <th valign="top">関数名</th>
        <th valign="top">関数の説明</th>
      </tr>
      <tr>
        <td valign="top" class="codeheader">plugin_profilevariablesedit_&lt;プラグイン名&gt;</td>
        <td valign="top" class="code">ユーザプロフィールを編集するフォームが表示される直前に、この関数は呼び出される。パラメータとして、ユーザIDと編集用テンプレートへの参照（レファレンス）が渡される。この関数は、独自のテンプレート変数（{変数名}）と入力フィールドをテンプレートに追加できる。<br>
この関数は返り値を持たない。テンプレートにデータを追加するには、Templateクラスのメソッド（<code>set_var</code> など）を用いる。</td>
      </tr>
      <tr>
        <td valign="top" class="codeheader">plugin_profileblocksedit_&lt;プラグイン名&gt;</td>
        <td valign="top" class="code">ユーザプロフィールを編集するフォームが表示される直前に、この関数は呼び出される。パラメータとしてユーザIDが渡される。この関数は、ユーザプロフィールを編集するフォームに表示したいブロック（ブロックのヘッダ・フッタを含む）のHTMLを返すことができる。複数のデータを要求する場合は、こちらの関数を使って項目をグループ化した方がよいだろう。それ以外の場合は、上述の <code>plugin_profilevariablesedit_&lt;プラグイン名&gt;</code> を使う方がよいだろう。<br>
この関数は、ブロックのHTMLか空文字列を返さなければならない。</td>
      </tr>
      <tr>
        <td valign="top" class="codeheader">plugin_profilevariablesdisplay_&lt;プラグイン名&gt;</td>
        <td valign="top" class="code">ユーザプロフィールが表示される直前に、この関数は呼び出される。パラメータとして、ユーザIDと編集用テンプレートへの参照（レファレンス）を受け取る。この関数は、独自のテンプレート変数（{変数名}）をテンプレートに追加できる。<br>
この関数は返り値を持たない。テンプレートにデータを追加するには、Templateクラスのメソッド（<code>set_var</code> など）を用いる。</td>
      </tr>
      <tr>
        <td valign="top" class="codeheader">plugin_profileblocksdisplay_&lt;プラグイン名&gt;</td>
        <td valign="top" class="code">ユーザプロフィールが表示される直前に、この関数は呼び出される。パラメータとしてユーザIDが渡される。この関数では、ユーザプロフィールに表示したいブロックのHTMLを返すことができる。<br>
この関数は、ブロックのHTMLか空文字列を返さなければならない。</td>
      </tr>
    </table>

<h2><a name="Misc_Functions">その他の関数</a></h2>

<p>以下の関数は上記以外の用途のためのオプションの関数です。</p>

  <table>
    <caption style="caption-side:bottom">表9. その他の関数</caption>
      <tr>
        <th valign="top">関数名</th>
        <th valign="top">関数の説明</th>
      </tr>
      <tr>
        <td valign="top" class="codeheader">plugin_centerblock_&lt;プラグイン名&gt;</td>
        <td valign="top" class="code">この関数では、サイトのセンターエリア、つまり、記事と記事の間にブロックを表示することができる。この関数は、サイトのインデックスページを表示する間に数回呼ばれる。パラメータはインデックスページのどこにセンターブロックを表示するかを指定する。<br>
パラメータは、 <code>場所(where)</code> (1 = ページの最上部, 2 = 注目記事の後, 3 = ページの最下部)、<code>ページ数(page number)</code>、<code>話題ID(topic id)</code>である。<code>where</code> を 0 にすると、全画面表示になる（この場合、サイトのヘッダ・フッタを含めて<strong>全画面</strong>に相当するHTMLを返さなければならない）。<br>
この関数は、ブロックのHTML（ヘッダ・フッタを含む）か空文字列を返さなければならない。</td>
      </tr>
      <tr>
        <td valign="top" class="codeheader">plugin_getheadercode_&lt;プラグイン名&gt;</td>
        <td valign="top" class="code">サイトの <code>&lt;head&gt;</code> ブロックに追加するJavaScriptや <code>&lt;meta&gt;</code> タグを返す。<br>
この関数では、追加のヘッダ全部を改行文字(&yen;n)でつないだものを返さなければならない。</td>
      </tr>
      <tr>
        <td valign="top" class="codeheader">plugin_templatesetvars_&lt;プラグイン名&gt;</td>
        <td valign="top" class="code">追加のテンプレート変数をセットできる。現時点では、この関数が呼ばれるのは <code>COM_siteHeader</code> と <code>COM_siteFooter</code> の中だけであるが、将来は他の場所で呼び出されるようになるだろう。渡されるパラメータは、テンプレート名とテンプレートオブジェクトへの参照（レファレンス）である。プラグインAPI側では、テンプレート名（上述の通り、現時点ではヘッダかフッタ）をチェックし、渡されたテンプレートオブジェクトのレファレンスを使用して、必要なテンプレート変数を設定する。</td>
      </tr>
    <tr>
        <td valign="top" class="codeheader">plugin_whatsnewsupported_&lt;プラグイン名&gt;</td>
        <td valign="top" class="code">この関数と次の関数を実装することで、プラグイン独自のセクションを新着情報ブロックに表示できる。<br>
        この関数は2つの文字列から構成される配列を返す。1番目の文字列はプラグインのセクションの見出しとして、2番目の文字列はそのセクションが表示する期間（"last 2 weeks"など）として使用される。</td>
    </tr>
    <tr>
        <td valign="top" class="codeheader">plugin_getwhatsnew_&lt;プラグイン名&gt;</td>
        <td valign="top" class="code">この関数は、新着情報ブロックに表示する新規項目の配列を返す（新規項目がない場合はその旨を表示する文字列）。</td>
    </tr>
    <tr>
        <td valign="top" class="codeheader">plugin_chkVersion_&lt;プラグイン名&gt;</td>
        <td valign="top" class="code">プラグインではこの関数を実装し、コードのバージョンを返さなければならない。新しいバージョンを公開する前に、プラグイン利用者が容易に更新できるようにするため、プラグインの <tt>functions.inc</tt> に含まれるコードのバージョンを表す変数を使用するべきである（訳注：プラグインのバージョンは、<tt>functions.inc</tt> よりもプラグインの <tt>config.php</tt> 内に記述した方がメンテナンスしやすい）。Geeklog 1.3.10の時点では、このAPI関数が呼び出されるのは、インストールされているプラグインのバージョンとコードのバージョンを表示するプラグインエディタの中である。インストールされているプラグインのバージョンは、<code>plugins</code> テーブルから取り出され、プラグインのインストール・アップグレード時に更新すべきである。このAPI関数を使うと、サイト管理者は現在のプラグインのコードがインストールされているバージョンより新しいか知ることができる。プラグイン開発者は <code>plugins</code> テーブルからインストールされているバージョンを読み取り、SQLを用いたアップデートが必要かどうかや <code>plugins</code> テーブルの情報を更新してコードのバージョンに合わせるかどうかを自動的に決定することができる。</td>
    </tr>
    <tr>
        <td valign="top" class="codeheader">plugin_runScheduledTask_&lt;プラグイン名&gt;</td>
        <td valign="top" class="code">この関数を使用すると、作業を定期的に実行することができる。（OSレベルで実行されるcronジョブと違い、）この関数が呼び出されるのはサイトに訪問者があるときだけだが、メンテナンスやクリーンアップを定期的に行う大半のプラグインにとってはそれで十分であろう。この関数が呼び出される間隔はサイトのコンフィギュレーションで設定されるので、このAPIを実装するすべてのプラグインが一度にまとめて呼び出される（訳注：したがって、時間のかかる作業を実行させると、PHPやWebサーバが時間切れになってしまう。そのような作業にはcronジョブを用いるべき。）。</td>
    </tr>

  </table>

  <h2><a name="Feed_Functions">フィード用関数</a></h2>

<p>以下の関数は、フィード（RSSフィード）を作成するためのオプションの関数一覧です。</p>

  <table>
    <caption style="caption-side:bottom">表10. フィード用関数</caption>
      <tr>
        <th valign="top">関数名</th>
        <th valign="top">関数の説明</th>
      </tr>
      <tr>
        <td valign="top" class="codeheader">plugin_getfeednames_&lt;プラグイン名&gt;</td>
        <td valign="top" class="code">プラグインはフィードを作成するためのコンテンツを提供できるが、この関数では提供できるフィードコンテンツのリストを返す。たとえば、リンクプラグインはすべてのリンクに対するフィードとリンクカテゴリに対するフィードを提供する。この関数では、IDと名前をペアにした配列を返す。IDはコンテンツの種類を表すプラグイン内部で使用されるIDであり、名前はユーザに表示される名前である。</td>
      </tr>
      <tr>
        <td valign="top" class="codeheader">plugin_getfeedcontent_&lt;プラグイン名&gt;</td>
        <td valign="top" class="code">プラグインが上述の <code>plugin_getfeednames_&lt;プラグイン名&gt;</code> APIでフィードのリストを返す場合、この関数を用いてフィードのコンテンツを返さなければならない。フィードのコンテンツを保持する配列と、フィードに含まれサイト上にあるそのコンテンツを指す 'link' と更新チェック用に保存される 'update_data' を返す。</td>
      </tr>
      <tr>
        <td valign="top" class="codeheader">plugin_feedExtensionTags_&lt;プラグイン名&gt;</td>
        <td valign="top" class="code">この関数を実装することで、フィードフォーマットのトップレベルに要素を追加することができる。フィードの種類とバージョン（たとえば、RSS version 2.0）を受け取り、有効なXMLタグの配列を返す。具体例は、<a href="http://sourceforge.net/project/showfiles.php?group_id=91120&amp;package_id=168689">フィード拡張(Syndication Extensions)</a>プラグインを見ること。</td>
      </tr>
    <tr>
        <td valign="top" class="codeheader">plugin_feedNSExtensions_&lt;プラグイン名&gt;</td>
        <td valign="top" class="code">フィードに独自の要素を追加するプラグインは、XMLに名前空間を追加しなければならないことがある。その場合、この関数を使用して有効な名前空間の属性の配列を返さなければならない。具体例は、<a href="http://sourceforge.net/project/showfiles.php?group_id=91120&amp;package_id=168689">フィード拡張(Syndication Extensions)</a>プラグインを見ること。</td>
    </tr>
    <tr>
        <td valign="top" class="codeheader">plugin_feedElementExtensions_&lt;プラグイン名&gt;</td>
        <td valign="top" class="code">この関数を実装することで、フィードの項目に要素を追加することができる。フィードの種類とバージョン及びコンテンツの種類とIDを受け取り、有効なXML要素の配列を返さなければならない。具体例は、<a href="http://sourceforge.net/project/showfiles.php?group_id=91120&amp;package_id=168689">フィード拡張(Syndication Extensions)</a>プラグインを見ること。</td>
    </tr>
  </table>


<h2><a name="Implementing_your_Admin_Interface">独自の管理者インターフェースの実装</a></h2>

<p>GeeklogのプラグインAPIは所詮APIに過ぎないので、プラグインのコードは全部自分で書かなければなりません。私たちは、プラグインの管理者インターフェース用のスタブをしかるべき場所に配置しただけです。プラグインの管理者用ページのURLは <tt>http://yourgeeklogdomain/admin/plugins/&lt;プラグイン名&gt;/</tt> になります。</p>

<p>管理者用インターフェースの最初のページは <tt>index.php</tt> という名前で、上述のディレクトリ内になければなりません。管理者用インターフェースに複数ページを使用するかどうかは開発者に委ねられています。</p>

<p><strong>管理者用ページの位置は自由に変更できない</strong>ことに注意してください。全体に整合性を持たせるために、このドキュメントで触れている標準規約に従うことが重要です。</p>

<h2><a name="Preparing_your_Geeklog_Plugin">プラグイン配布の準備</a></h2>

<h3>プラグインのアーカイブファイル</h3>

<p>Geeklogプラグインのアーカイブファイルは、次の命名規約に従うべきです。</p>

<p style="margin-left:4em;">
&lt;プラグイン名&gt;_&lt;プラグインのバージョン&gt;_&lt;Geeklogのバージョン&gt;.tar.gz
</p>

<h3>説明</h3>
<dl>
<dt>&lt;プラグイン名&gt;：</dt><dd style="margin-bottom:1em">これはプラグイン作成時に決めなければならない最重要事項の1つです。なぜなら、このプラグイン名によって
      <ul>
        <li>Geeklogのコアコードが呼び出すAPI関数名</li>
        <li>プラグイン関係のすべてのファイルを置くドキュメントツリー内の位置</li>
        <li>管理者用コードを置くadminディレクトリ内のディレクトリ名</li>
        <li>モデレーションを行う場合は、主テーブルの名前</li>
        <li>モデレーションを行う場合は、副テーブルの名前（主テーブル名 + submission）</li>
      </ul>が決まるからです。</dd>

<dt>&lt;プラグインのバージョン&gt;：</dt><dd style="margin-bottom:1em">プラグインをインストール中に、新規インストールするのかアップグレードするのかを判断するために使用されます。インストールされているバージョンより古いバージョンをインストールしようとしていないか検証するためにも使用されます。</dd>
<dt>&lt;Geeklogのバージョン&gt;：</dt><dd>プラグインが動作するGeeklogのバージョン。</dd>
</dl>

<p>アーカイブファイルの構成も標準化されています。ディレクトリとファイル名ごとに説明します。アーカイブファイルを作成するとき、トップのディレクトリ名は &lt;プラグイン名&gt; と同じにすべきです。そのディレクトリ内に以下のディレクトリ・ファイルを配置します。</p>

<dl>
<dt>config.php：</dt><dd style="margin-bottom:1em">プラグインの設定用ファイル。可能なら（Geeklog-1.5に関しては）Geeklogに組み込まれているコンフィギュレーションインターフェースを使用することをお勧めします。そちらの方がプラグインを使用する人にとっては遙かに簡単だからです。Geeklog Wikiの<a href="http://wiki.geeklog.net/wiki/index.php/PluginConfiguration">プラグインでコンフィギュレーションを使用する方法(how to use the configuration for a plugin)</a>に追加情報があります。</dd>
<dt>functions.inc：</dt><dd style="margin-bottom:1em">このファイルにGeeklogのAPI関数とプラグインのコードを置くべきです。<tt>lib-common.php</tt> の最後の部分で、有効になっているプラグインの <tt>functions.inc</tt> ファイルを読み込むので、ファイル名は <tt>functions.inc</tt> でなければなりません。逆に言うと、プラグインのコード内では、<tt>lib-common.php</tt> 内のすべての関数を呼び出すことができるということです。</dd>
<dt>language/ ディレクトリ：</dt><dd style="margin-bottom:1em">プラグインの言語ファイルの置き場所。言語ファイルはプラグインの <tt>functions.inc</tt> の先頭で読み込むべきです。<br>Geeklogの振る舞いを模倣し、ユーザが設定した言語に対応できるよう <tt>language</tt> ディレクトリ内に言語ファイル（<tt>english.php</tt> など）を置くことをお勧めします。選択した言語に対応する言語ファイルが存在しない場合は、既定の言語ファイル（<tt>english.php</tt>など）が選ばれます。</dd>

<dt>README</dt><dd style="margin-bottom:1em">標準的な、ソフトウェアのREADMEファイル。</dd>
<dt>/docs:</dt><dd style="margin-bottom:1em">プラグインの改訂履歴やTO-DOなどを置きます。</dd>
<dt>/admin:</dt><dd style="margin-bottom:1em">管理者用ページを置きます。</dd>
<dt>/public_html:</dt><dd style="margin-bottom:1em">標準的な、サイトを構成するファイルを置きます。</dd>
<dt>/updates:</dt><dd style="margin-bottom:1em">更新用のSQLとPHPスクリプトを置きます。</dd>
</dl>

<h2><a name="How_Geeklog_Installs_Plugins">プラグインのインストール方法</a></h2>

<p><strong>注意：</strong> Geeklog-1.3.4までは、プラグインを自動的にインストールする機構がありました。しかしながら、多くのトラブルとサポートの問題が生じたので、以降のバージョンでは廃止されています。以下に述べる手動インストールの手順がプラグインをインストールする標準的な方法で、Geeklogのバージョンを問わず機能します。</p>

<p>詳細は、プラグインに添付されている <tt>README</tt> ファイルを常に参照すべきです。プラグインの概要とインストールの詳細な手順は、Geeklogドキュメント作成プロジェクトの一環として、<a href="http://wiki.geeklog.net/index.php/Plugins">ここで公開されています</a>。しかしながら、一般的には、次のようにしてプラグインをインストールします。</p>

<ol>
<li>セットアップとサーバへのアクセスにもよりますが、アーカイブファイルをアップロードしてリモートで展開（伸張・解凍）するか、ローカルで展開した後でできたディレクトリとファイルをアップロードするかのどちらかです。</li>
<li>アーカイブファイル中の <tt>public_html</tt> は、Webサーバの公開領域の下に &lt;プラグイン名&gt; の名前でコピーします。たとえば、Geeklogのサイトが <tt>/path/to/geeklog/public_html/</tt> にある場合、アーカイブファイルの <tt>public_html</tt> ディレクトリの内容は <tt>/path/to/geeklog/public_html/&lt;プラグイン名&gt;</tt> の中にコピーします。</li>
<li>アーカイブファイルの <tt>admin</tt> ディレクトリは、管理者用エリアにコピーします。たとえば、管理者用エリアが <tt>/path/to/geeklog/public_html/admin/</tt> の場合、アーカイブファイルの <tt>admin</tt> ディレクトリの内容は、 <tt>/path/to/geeklog/public_html/admin/plugins/&lt;プラグイン名&gt;</tt> の中にコピーします。</li>
<li>プラグインのインストール用スクリプト（<tt>http://yourgeeklogsite/admin/plugins/&lt;プラグイン名&gt;/install.php</tt>）を呼び出します。
  <ul>
  <li>新規インストールの場合（プラグインが <tt>plugins</tt> テーブルに存在しない場合）、インストールスクリプトは必要なSQLを発行してテーブルと初期データを作成します。</li>
  <li>アップグレードの場合、提供されているプラグインのドキュメントを参照する必要があります。比較的新しいプラグインAPIはアップグレードを実行するAPIを提供しています。プラグインエディタを使用すれば、必要なら更新をブラウザから実行できます。</li>
  </ul></li>
<li>これでおしまいです!</li>
</ol>

<h2><a name="Deliver_Your_Plugin">プラグインの配布</a></h2>

<p>GeeklogのプラグインはインストールされているGeeklogやユーザのファイルシステムに影響を与える可能性があるので、開発者チームが検証したものでなければサードパーティ製のプラグインを承認しないことになっています。プラグインをきちんとインストールでき、トラブルを引き起こさないことを確認したいからです。確認できれば、開発者がアップロードしたアーカイブファイルをGeeklogユーザがダウンロードできる場所に置きます。開発したプラグインを http://www.geeklog.net/ に投稿してもよいでしょう。</p>

<div class="footer">
    <a href="http://wiki.geeklog.net/">Geeklogドキュメント作成プロジェクト(The Geeklog Documentation Project)</a><br>
    本ページのすべての商標と著作権はそれぞれの所有者に帰属します。Geeklogはコピーレフトです。
</div>

</body>
</html>
